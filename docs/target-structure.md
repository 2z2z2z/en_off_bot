# Целевая структура каталогов

Документ фиксирует верхнеуровневую структуру модулей, которая используется в фазах рефакторинга. Структура отражает выделение инфраструктуры, доменных сервисов и презентационного слоя. На момент завершения Фазы 0 минимально заполнены только необходимые элементы (логирование, тесты), остальные директории будут наполняться на следующих фазах.

```
.
├── index.js                   # Точка входа до завершения Фазы 1 (bootstrap остаётся здесь)
├── encounter-api.js           # Клиент Encounter, будет декомпозирован в Фазе 4
├── src
│   ├── infra                  # Инфраструктура и адаптеры систем
│   │   └── logger.js          # Конфигурация pino и обёртка уровней
│   ├── core                   # Доменные сервисы и бизнес-логика
│   │   ├── answer-service.js  # Композиция доменных модулей (delivery, queue)
│   │   ├── auth-manager.js    # Централизация авторизации Encounter
│   │   └── user-store.js      # Работа с пользовательскими данными (до миграции на SQLite)
│   ├── features
│   │   ├── answer
│   │   │   ├── answer-delivery.js
│   │   │   ├── batch-buffer.js
│   │   │   ├── burst-detector.js
│   │   │   └── contracts.js
│   │   └── router.js
│   ├── platforms              # Платформенные адаптеры (Telegram, VK)
│   │   ├── telegram
│   │   │   └── telegram-adapter.js
│   │   └── vk
│   │       └── vk-adapter.js
│   └── utils                  # Вспомогательные функции без побочных эффектов
│       └── parse-game-url.js
├── __tests__
│   ├── answer-service.test.js
│   ├── burst-detector.test.js
│   ├── parse-game-url.test.js
│   └── fixtures
│       └── user_data_large.json
└── docs
    └── target-structure.md    # Текущий документ
```

## План заполняемости директорий

- **infra/**
  - `logger.js` — единый pino-логгер (реализовано).
  - `config/` — загрузка конфигов и переменных окружения (Фаза 1).
  - `storage/` — драйверы БД после миграции на SQLite (Фаза 3).

- **core/**
  - `bootstrap/` — запуск и DI контейнер (Фаза 1).
  - `answer-service/` — декомпозированные модули (`answer-delivery`, `queue-processor`, `burst-detector`, `batch-buffer`) в Фазе 2.
  - `services/` — whitelist, runtime-state, уведомления (Фазы 2-3).

- **platforms/**
  - Текущие адаптеры Telegram/VK остаются.
  - Будущие платформы (Discord/web) будут добавлены через фабрики keyboard/message (Фаза 4).

- **presentation/**
  - Появится в Фазе 1-2 для форматирования сообщений и клавиатур вне core.

Документ используется как эталон при отметке прогресса по фазам: добавление или перемещение файлов фиксируется через обновления `impl.md` и сопоставляется с указанной структурой.
