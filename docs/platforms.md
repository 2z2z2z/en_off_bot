# Platform Behaviour

–ö–æ–¥ –±–æ—Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω –ø–æ–≤–µ—Ä—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ `PlatformAdapter`. –°–µ–π—á–∞—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è Telegram –∏ VK. –ù–∏–∂–µ ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞.

## –û–±—â–∏–π –ø–æ—Ç–æ–∫

1. –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –≤ `PlatformEventType` (`TEXT`, `COMMAND`, `CALLBACK` –∏ —Ç.–¥.).
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –∫–ª—é—á—ë–º `{ platform, userId }`, –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `user_data.json`.
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:
   - —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏;
   - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ—Ç–µ–∫—Ç–æ—Ä bursts (`pendingBurstAnswers`): –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã (<2.5 —Å–µ–∫) —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –±—É—Ñ–µ—Ä –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è;
   - –ø—Ä–∏ —Å–º–µ–Ω–µ —É—Ä–æ–≤–Ω—è —Å–æ–∑–¥–∞—ë—Ç—Å—è `pendingAnswerDecision` —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/–æ—Ç–º–µ–Ω—ã.
4. `/start` –∏ –∫–Ω–æ–ø–∫–∞ ¬´üîÑ –†–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞¬ª –æ—á–∏—â–∞—é—Ç –æ—á–µ—Ä–µ–¥–∏, –±—É—Ñ–µ—Ä—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è, –µ—Å–ª–∏ –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ).

## –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞

–ï–¥–∏–Ω–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ –∑–∞–¥–∞—ë—Ç—Å—è –≤ `index.js` (`MAIN_MENU_LAYOUT`):

| –†—è–¥ | Telegram | VK |
|-----|----------|----|
| 1   | `–ó–∞–¥–∞–Ω–∏–µ`, `–ó–∞–¥–∞–Ω–∏–µ (—Ñ–æ—Ä–º–∞—Ç)` | —Ç–µ –∂–µ –¥–≤–µ –∫–Ω–æ–ø–∫–∏ |
| 2   | `–°–µ–∫—Ç–æ—Ä–∞` | `–°–µ–∫—Ç–æ—Ä–∞` |
| 3   | `üîó –°–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É`, `üë§ –°–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é` | —Ç–µ –∂–µ –¥–≤–µ –∫–Ω–æ–ø–∫–∏ |
| 4   | `üîÑ –†–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞` | `üîÑ –†–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞` |

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫ –≤–µ–∑–¥–µ –æ–¥–∏–Ω: —Å–æ–±—ã—Ç–∏–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `handleReadyStateInput`.

## Telegram

- –ê–¥–∞–ø—Ç–µ—Ä `TelegramAdapter` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç long polling.
- Inline-–∫–Ω–æ–ø–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `callback_query`, payload ‚Äî —Å—Ç—Ä–æ–∫–∞ (`answer_send`, `batch_cancel_all` –∏ —Ç.–ø.).
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram: –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ `editMessage` —Ä–∞–∑ –≤ 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –î–ª—è —ç—Ç–æ–≥–æ –≤ `index.js` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è throttle (`messageUpdateThrottle`).
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–µ `/start` –∏ ¬´üîÑ –†–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞¬ª.
- –§–∞–π–ª—ã: `src/platforms/telegram/telegram-adapter.js`.

## VK

- –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `vk-io`, long poll –≥—Ä—É–ø–ø—ã.
- Payload inline-–∫–Ω–æ–ø–æ–∫ ‚Äî JSON –≤–∏–¥–∞ `{ action: 'answer_send' }`; –∞–¥–∞–ø—Ç–µ—Ä –ø–∞—Ä—Å–∏—Ç `context.eventPayload` / `context.payload`.
- Snackbar-–æ—Ç–≤–µ—Ç –≤ `answerCallback` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (¬´–û—Ç–ø—Ä–∞–≤–∫–∞‚Ä¶¬ª, ¬´–û—Ç–º–µ–Ω–µ–Ω–æ¬ª).
- –í progress-—Å–æ–æ–±—â–µ–Ω–∏—è—Ö –¥–æ—Å—Ç—É–ø–Ω—ã `peer_id` –∏ `conversation_message_id`, –ø–æ—ç—Ç–æ–º—É –±–æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ.
- –§–∞–π–ª—ã: `src/platforms/vk/vk-adapter.js`.

## Callbacks –∏ —Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

| –°—Ü–µ–Ω–∞—Ä–∏–π                       | –°–æ–±—ã—Ç–∏–µ            | –î–µ–π—Å—Ç–≤–∏–µ                                                           |
|--------------------------------|--------------------|--------------------------------------------------------------------|
| –°–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è –ø—Ä–∏ –æ–¥–∏–Ω–æ—á–Ω–æ–º –æ—Ç–≤–µ—Ç–µ | `answer_send`      | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ—Ç `lastKnownLevel`, —Å–æ–æ–±—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç   |
|                                | `answer_cancel`    | –û—á–∏—â–∞–µ—Ç pending, –æ–±–Ω–æ–≤–ª—è–µ—Ç `lastKnownLevel` —á–µ—Ä–µ–∑ `getGameState`   |
| –°–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è –ø—Ä–∏ –ø–∞—á–∫–µ         | `batch_send_force` | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∫–æ–¥—ã –≤ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å                        |
|                                | `batch_cancel_all` | –û—á–∏—â–∞–µ—Ç –±—É—Ñ–µ—Ä –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è                                           |
| –ü—Ä–æ—Å–º–æ—Ç—Ä –±—É—Ñ–µ—Ä–∞                | `batch_list`       | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤                                |
| –û—á–µ—Ä–µ–¥—å –æ—Ñ–ª–∞–π–Ω-–æ—Ç–≤–µ—Ç–æ–≤         | `queue_send`       | –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç –æ—á–µ—Ä–µ–¥—å –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É           |
|                                | `queue_clear`      | –û—á–∏—â–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å                                                    |

## –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

- `user_data.json` —Å–æ–¥–µ—Ä–∂–∏—Ç:
  - `accumulatedAnswers`, `accumulationStartLevel`, `isAccumulatingAnswers`;
  - `answerQueue` –∏ —Ñ–ª–∞–≥ `isProcessingQueue`;
  - —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π `password` (—Å–º. `src/utils/crypto.js`);
  - –∏—Å—Ç–æ—Ä–∏—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (username, timestamps).
- `admin_config.json` —Ö—Ä–∞–Ω–∏—Ç whitelist; –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤.

## –ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å

- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –≤ Telegram, –∏ –≤ VK ‚Äî —Å—á–∏—Ç–∞—Ç—å—Å—è –±—É–¥—É—Ç —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ (–∫–ª—é—á –≤–∫–ª—é—á–∞–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É).
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –¥–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏: –æ—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ Encounter —Å—Ç–∞–Ω–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏ Telegram, –∏ VK (–æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–π `MAIN_MENU_LAYOUT`, –Ω–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è —Ç–∏–ø–æ–º –∫–Ω–æ–ø–æ–∫).
