# Executive Summary: ÐÐºÑ‚ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð»Ð°Ð½Ð° Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°

## ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚

ÐŸÐ¾ÑÐ»Ðµ Ð¿Ñ€Ð¾Ð²ÐµÐ´Ñ‘Ð½Ð½Ð¾Ð³Ð¾ Ð°ÑƒÐ´Ð¸Ñ‚Ð° Ð¿ÐµÑ€Ð²Ð¾Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¿Ð»Ð°Ð½Ð° Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ñ‹ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð½ÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ñ†ÐµÐ½ÐºÐ°Ð¼Ð¸ Ð¸ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÐµÐ¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°. Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»Ñ‘Ð½Ð½Ð¾Ðµ Ð²Ð¸Ð´ÐµÐ½Ð¸Ðµ Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ production Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð° Ð¸ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð¼ÐµÑ‚Ñ€Ð¸Ðº ÐºÐ¾Ð´Ð¾Ð²Ð¾Ð¹ Ð±Ð°Ð·Ñ‹.

---

## ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ

### 1. ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð¾Ð²

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** Ð Ð°Ð·Ð¼ÐµÑ€Ñ‹ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð±Ñ‹Ð»Ð¸ Ð·Ð°Ð½Ð¸Ð¶ÐµÐ½Ñ‹ Ð½Ð° 15-20%, Ñ‡Ñ‚Ð¾ Ð¸ÑÐºÐ°Ð¶Ð°Ð»Ð¾ Ð¾Ñ†ÐµÐ½ÐºÑƒ ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸.

**Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾:**
- `index.js`: 2738 â†’ **3184 ÑÑ‚Ñ€Ð¾ÐºÐ¸** (+16%)
- `encounter-api.js`: 709 â†’ **817 ÑÑ‚Ñ€Ð¾Ðº** (+15%)
- `answer-service.js`: 602 â†’ **724 ÑÑ‚Ñ€Ð¾ÐºÐ¸** (+20%)
- **Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾:** ÐœÐµÑ‚Ð¾Ð´ `sendAnswerToEncounter` = **259 ÑÑ‚Ñ€Ð¾Ðº (ÑÑ‚Ñ€Ð¾ÐºÐ¸ 78-336)** (Ð°Ð½Ñ‚Ð¸Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½, Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ð½Ð¾Ð¹ Ð´ÐµÐºÐ¾Ð¼Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸)

### 2. ÐŸÐµÑ€ÐµÐ¾Ñ†ÐµÐ½Ñ‘Ð½ SQLite: Ð¸Ð· "nice-to-have" Ð² "ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚ÑŒ"

**Ð‘Ñ‹Ð»Ð¾:** "Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ Ð½Ð° SQLite" (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ)

**Ð¡Ñ‚Ð°Ð»Ð¾:** **ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾** Ð´Ð»Ñ production Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð°

**ÐžÐ±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
- **Production Ð¼Ð°ÑÑˆÑ‚Ð°Ð±:** 100-500+ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ (Ð½Ðµ 1-2 ÐºÐ°Ðº Ð² dev)
- **Ð Ð¾ÑÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…:** JSON Ð²Ñ‹Ñ€Ð°ÑÑ‚ÐµÑ‚ Ð´Ð¾ 5-10MB (Ð½Ðµ 8KB ÐºÐ°Ðº Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾)
- **ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ JSON:**
  - ÐŸÐ¾Ð»Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð² Ð¿Ð°Ð¼ÑÑ‚ÑŒ (10MB Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼)
  - ÐŸÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÑŒ Ð²ÑÐµÐ³Ð¾ Ñ„Ð°Ð¹Ð»Ð° Ð¿Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ save
  - ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ â†’ Ñ€Ð¸ÑÐº Ð¿Ð¾Ñ‚ÐµÑ€Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…
  - Race conditions Ð¿Ñ€Ð¸ concurrent writes
  - O(n) Ð¿Ð¾Ð¸ÑÐº Ð±ÐµÐ· Ð¸Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ð¸
  - ÐÐµÑ‚ query Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÐµÐ¹
  - ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ TTL-Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸

**SQLite Ñ€ÐµÑˆÐ°ÐµÑ‚:**
- Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ â†’ Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
- Ð˜Ð½Ð´ÐµÐºÑÑ‹ â†’ O(log n) Ð¿Ð¾Ð¸ÑÐº
- Query â†’ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ð¸ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹
- TTL â†’ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
- Incremental backups Ð±ÐµÐ· Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸

### 3. ÐŸÐµÑ€ÐµÐ¾Ñ†ÐµÐ½ÐµÐ½Ð° Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼ÐµÐ½Ð½Ñ‹Ñ… Ð°Ð´Ð°Ð¿Ñ‚ÐµÑ€Ð¾Ð²

**Ð‘Ñ‹Ð»Ð¾:** "ÐÐµÑ‚ ÐµÐ´Ð¸Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ð° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹, Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¿Ð¾Ð»Ð½Ð°Ñ Ð¿ÐµÑ€ÐµÑ€Ð°Ð±Ð¾Ñ‚ÐºÐ°"

**Ð¤Ð°ÐºÑ‚:** ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð£Ð–Ð• Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ð½Ð° **80-90%**:
- `PlatformAdapter` Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹ ÐºÐ»Ð°ÑÑ Ñ `PlatformEventType`
- ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ñ‡ÐµÑ€ÐµÐ· `_normalizeEvent()`
- Ð•Ð´Ð¸Ð½Ñ‹Ð¹ transport registry Ð² `messenger.js`
- index.js Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ñ€Ð¾Ð»ÑŒ router'Ð°

**Ð§Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð½ÑƒÐ¶Ð½Ð¾:**
- Ð¤Ð°Ð±Ñ€Ð¸ÐºÐ° ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€ (Ð²Ñ‹Ð½Ð¾Ñ `if (platform === 'telegram')`)
- Presentation-ÑÐ»Ð¾Ð¹ Ð´Ð»Ñ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
- **ÐÐ• Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ:** ÐŸÐµÑ€ÐµÐ¿Ð¸ÑÑ‹Ð²Ð°Ð½Ð¸Ðµ Ð°Ð´Ð°Ð¿Ñ‚ÐµÑ€Ð¾Ð², "ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹ Ð´Ð»Ñ Discord/web" (YAGNI)

### 4. Ð£Ð¿Ñ€Ð¾Ñ‰ÐµÐ½Ð° Ð´ÐµÐºÐ¾Ð¼Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Encounter API

**Ð‘Ñ‹Ð»Ð¾:** Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÑŒ Ð½Ð° 4 ÐºÐ»Ð°ÑÑÐ° (EncounterTransport, SessionManager, LevelCache, EncounterClient)

**Ð¡Ñ‚Ð°Ð»Ð¾:** ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ:
- ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ ÐºÐ»Ð°ÑÑÑ‹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð²Ð¼ÐµÑÑ‚Ð¾ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ñ… ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ð¹
- Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (pino)

**ÐžÐ±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ:** Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ rate limiter, ÐºÐµÑˆÐ° Ð¸ authCallback ÑƒÐ¶Ðµ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð°Ñ. Ð˜Ð·Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ð°Ñ Ð´ÐµÐºÐ¾Ð¼Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ ÑÐ½Ð¸Ð·Ð¸Ñ‚ Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ.

### 5. Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ñ„Ð°Ð·

**Ð‘Ñ‹Ð»Ð¾:** Ð¤Ð°Ð·Ð° 0 â†’ 1 â†’ 2 â†’ ... â†’ 7 (Ñ‚ÐµÑÑ‚Ñ‹ Ð¸ Ð»Ð¾Ð³Ð³ÐµÑ€ Ð² ÐºÐ¾Ð½Ñ†Ðµ)

**Ð¡Ñ‚Ð°Ð»Ð¾:**
```
Ð¤Ð°Ð·Ð° 0: Ð˜Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° (Ñ‚ÐµÑÑ‚Ñ‹ + Ð»Ð¾Ð³Ð³ÐµÑ€) â€” ÐŸÐ•Ð Ð’Ð«Ðœ!
Ð¤Ð°Ð·Ð° 1: index.js Ð´ÐµÐºÐ¾Ð¼Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ
Ð¤Ð°Ð·Ð° 2.1: sendAnswerToEncounter (259 ÑÑ‚Ñ€Ð¾Ðº) â€” ÐŸÐ Ð˜ÐžÐ Ð˜Ð¢Ð•Ð¢
Ð¤Ð°Ð·Ð° 2.2: ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ answer-service
Ð¤Ð°Ð·Ð° 3: SQLite Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ â€” ÐšÐ Ð˜Ð¢Ð˜Ð§ÐÐž
Ð¤Ð°Ð·Ð° 4: Encounter Ð¾ÑˆÐ¸Ð±ÐºÐ¸ + Ð»Ð¾Ð³Ð³ÐµÑ€
Ð¤Ð°Ð·Ð° 5: Presentation-ÑÐ»Ð¾Ð¹ (Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾)
Ð¤Ð°Ð·Ð° 6: ÐÐ´Ð¼Ð¸Ð½ÐºÐ° (ÑÑ€ÐµÐ´Ð½Ð¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚)
Ð¤Ð°Ð·Ð° 7: Ð¤Ð¸Ð½Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
```

**ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ:** Ð¢ÐµÑÑ‚Ñ‹ Ð¸ Ð»Ð¾Ð³Ð³ÐµÑ€ ÐŸÐ•Ð Ð•Ð” Ð½Ð°Ñ‡Ð°Ð»Ð¾Ð¼ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°, Ð¸Ð½Ð°Ñ‡Ðµ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¸Ñ.

---

## ÐÐ¾Ð²Ñ‹Ðµ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ñ‹

### P0 (ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ â€” Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð¿ÐµÑ€Ð²Ñ‹Ð¼Ð¸):
1. âœ… **Ð˜Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°:** pino logger, smoke-Ñ‚ÐµÑÑ‚Ñ‹, ESLint
2. âœ… **index.js Ð´ÐµÐºÐ¾Ð¼Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ:** 3184 ÑÑ‚Ñ€Ð¾ÐºÐ¸ â†’ Ð¼Ð¾Ð´ÑƒÐ»ÑŒÐ½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°
3. âœ… **sendAnswerToEncounter:** 259 ÑÑ‚Ñ€Ð¾Ðº â†’ 5-6 Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
4. âœ… **SQLite Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:** Ð”Ð»Ñ production Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð° (100-500+ users)

### P1 (Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚):
5. âœ… ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ answer-service (burst-detector, queue-processor)
6. âœ… ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ ÐºÐ»Ð°ÑÑÑ‹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð´Ð»Ñ Encounter API

### P2 (Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚):
7. âš ï¸ Presentation-ÑÐ»Ð¾Ð¹ (Ñ„Ð°Ð±Ñ€Ð¸ÐºÐ° ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€, Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ)
8. âš ï¸ ÐÐ´Ð¼Ð¸Ð½ÐºÐ° Ð¸ whitelist

### P3 (ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚):
9. ðŸ”» ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼ÐµÐ½Ð½Ñ‹Ðµ Ð°Ð´Ð°Ð¿Ñ‚ÐµÑ€Ñ‹ (ÑƒÐ¶Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ñ‹ Ð½Ð° 80%)

---

## ÐžÐ±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ SQLite (Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾)

### ÐœÐ°Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸ÐºÐ° Ñ€Ð¾ÑÑ‚Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² production:

**Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð¸:**
- 500 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ã— 3KB = 1.5MB

**ÐžÑ‡ÐµÑ€ÐµÐ´Ð¸ Ð¿Ñ€Ð¸ Ð¾Ñ„Ð»Ð°Ð¹Ð½Ðµ:**
- 50-100 ÐºÐ¾Ð´Ð¾Ð² Ð½Ð° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ = +2-5MB

**Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ timestamps Ð·Ð° Ð³Ð¾Ð´:**
- `recentMessageTimestamps` = +0.5-1MB

**Ð‘ÑƒÑ„ÐµÑ€Ñ‹ Ð½Ð°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð¸Ñ:**
- `accumulatedAnswers` = +1-2MB

**Ð˜Ð¢ÐžÐ“Ðž:** 5-10MB Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾, Ð´Ð¾ 50MB Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾

### Ð¡Ñ…ÐµÐ¼Ð° Ð‘Ð”:

```sql
-- Ð”Ð¾Ð»Ð³Ð¾Ð¶Ð¸Ð²ÑƒÑ‰Ð¸Ðµ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð¸
CREATE TABLE profiles (
  id INTEGER PRIMARY KEY,
  user_id TEXT UNIQUE,
  platform TEXT,
  login TEXT,
  encrypted_password TEXT,
  domain TEXT,
  INDEX idx_user_platform (user_id, platform)
);

-- Ð˜Ð³Ñ€Ð¾Ð²Ñ‹Ðµ ÑÐµÑÑÐ¸Ð¸
CREATE TABLE game_sessions (
  id INTEGER PRIMARY KEY,
  profile_id INTEGER,
  game_id TEXT,
  auth_cookies TEXT,
  last_level_id TEXT,
  FOREIGN KEY (profile_id) REFERENCES profiles(id) ON DELETE CASCADE,
  INDEX idx_game_id (game_id)
);

-- Runtime ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ
CREATE TABLE runtime_state (
  id INTEGER PRIMARY KEY,
  profile_id INTEGER UNIQUE,
  pending_answers TEXT,
  accumulated_answers TEXT,
  recent_timestamps TEXT,
  FOREIGN KEY (profile_id) REFERENCES profiles(id) ON DELETE CASCADE
);
```

### ÐŸÐ»Ð°Ð½ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸:

1. **Dual-write Ñ€ÐµÐ¶Ð¸Ð¼:** Ð—Ð°Ð¿Ð¸ÑÑŒ Ð² JSON + SQLite Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾
2. **ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ:** Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¿ÐµÑ€ÐµÐ½Ð¾ÑÐ° `user_data.json` â†’ SQLite
3. **Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:** 100+ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹, performance + stress tests
4. **ÐŸÐ¾ÑÑ‚ÐµÐ¿ÐµÐ½Ð½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´:** Ð§Ñ‚ÐµÐ½Ð¸Ðµ Ð¸Ð· SQLite, Ð·Ð°Ñ‚ÐµÐ¼ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ JSON
5. **Rollback:** Export Ð¸Ð· SQLite Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾ Ð² JSON

---

## Ð Ð¸ÑÐºÐ¸ Ð¸ Ð¼Ð¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ

### Ð Ð¸ÑÐº 1: Ð ÐµÐ³Ñ€ÐµÑÑÐ¸Ñ Ð±ÐµÐ· Ð°Ð²Ñ‚Ð¾Ñ‚ÐµÑÑ‚Ð¾Ð² (90% Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ)
**ÐœÐ¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ:** Ð¤Ð°Ð·Ð° 0 Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ ÐŸÐ•Ð Ð’ÐžÐ™ â€” smoke-Ñ‚ÐµÑÑ‚Ñ‹ Ð´Ð¾ Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°

### Ð Ð¸ÑÐº 2: ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ (50% Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ)
**ÐœÐ¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ:** Dual-write Ñ€ÐµÐ¶Ð¸Ð¼ + rollback plan + Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

### Ð Ð¸ÑÐº 3: ÐŸÐ¾Ñ‚ÐµÑ€Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ðµ Ð½Ð° SQLite
**ÐœÐ¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ:**
- Backup JSON Ð¿ÐµÑ€ÐµÐ´ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÐµÐ¹
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾ÑÐ»Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
- ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ñ fallback
- Git tags Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ñ„Ð°Ð·Ñ‹

### Ð Ð¸ÑÐº 4: Performance Ð´ÐµÐ³Ñ€Ð°Ð´Ð°Ñ†Ð¸Ñ
**ÐœÐ¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ:** Performance benchmarks Ð½Ð° 500+ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÑ…

---

## Ð§Ñ‚Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾ Ð¸Ð· Ð¿Ð»Ð°Ð½Ð° (YAGNI)

âŒ ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ð½Ð° SQLite ~~Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÐµÐ½~~ â†’ **ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÐ½**
âŒ Ð Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Encounter API Ð½Ð° 4 ÐºÐ»Ð°ÑÑÐ°
âŒ ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¿ÐµÑ€ÐµÑ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼ÐµÐ½Ð½Ñ‹Ñ… Ð°Ð´Ð°Ð¿Ñ‚ÐµÑ€Ð¾Ð²
âŒ CLI-ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ð° Ð´Ð»Ñ whitelist
âŒ REST endpoint Ð´Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½ÐºÐ¸
âŒ "Ð¨Ð°Ð±Ð»Ð¾Ð½Ñ‹ Ð´Ð»Ñ Ð½Ð¾Ð²Ñ‹Ñ… Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼" (Discord/web)

---

## Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð·

| Ð¤Ð°Ð·Ð° | ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ | ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|----------|-----------|----------|
| **0** | Ð˜Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° | **P0** | Ð›Ð¾Ð³Ð³ÐµÑ€, Ñ‚ÐµÑÑ‚Ñ‹, Ð»Ð¸Ð½Ñ‚ÐµÑ€ â€” ÐŸÐ•Ð Ð’Ð«Ðœ |
| **1** | index.js | **P0** | Ð”ÐµÐºÐ¾Ð¼Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ 3184 ÑÑ‚Ñ€Ð¾Ðº |
| **2.1** | sendAnswerToEncounter | **P0** | Ð”ÐµÐºÐ¾Ð¼Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ 259 ÑÑ‚Ñ€Ð¾Ðº |
| **2.2** | answer-service | P1 | Burst-detector, queue-processor |
| **3** | SQLite | **P0/P1** | ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð´Ð»Ñ production |
| **4** | Encounter API | P1 | ÐšÐ»Ð°ÑÑÑ‹ Ð¾ÑˆÐ¸Ð±Ð¾Ðº, Ð»Ð¾Ð³Ð³ÐµÑ€ |
| **5** | Presentation | P2 | Ð¤Ð°Ð±Ñ€Ð¸ÐºÐ° ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€, Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ |
| **6** | ÐÐ´Ð¼Ð¸Ð½ÐºÐ° | P2 | Whitelist, Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ |
| **7** | Ð¤Ð¸Ð½Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ | - | Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ, rollback, Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ |

---

## Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð°

### ÐÐµÐ´ÐµÐ»Ñ 1: Ð˜Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° (Ð¤Ð°Ð·Ð° 0)
1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ pino logger, Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÑÐµ console.*
2. ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ 10-15 smoke-Ñ‚ÐµÑÑ‚Ð¾Ð² ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ ESLint + Prettier
4. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ production-Ð¿Ð¾Ð´Ð¾Ð±Ð½Ñ‹Ð¹ Ð´Ð°Ñ‚Ð°ÑÐµÑ‚ (100+ users)

### ÐÐµÐ´ÐµÐ»Ñ 2-3: index.js (Ð¤Ð°Ð·Ð° 1)
5. Bootstrap Ð¼Ð¾Ð´ÑƒÐ»ÑŒ + dependency wiring
6. Ð’Ñ‹Ð½ÐµÑÑ‚Ð¸ handlers/ (commands, callbacks, text)
7. Ð’Ñ‹Ð½ÐµÑÑ‚Ð¸ formatters/ Ð¸ utils/
8. ÐžÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð² index.js Ñ‚Ð¾Ð»ÑŒÐºÐ¾ wiring

### ÐÐµÐ´ÐµÐ»Ñ 4: sendAnswerToEncounter (Ð¤Ð°Ð·Ð° 2.1)
9. Ð Ð°Ð·Ð±Ð¸Ñ‚ÑŒ 259 ÑÑ‚Ñ€Ð¾Ðº Ð½Ð° 5-6 Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹
10. Unit-Ñ‚ÐµÑÑ‚Ñ‹ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸

### Ð”Ð°Ð»ÐµÐµ: Ð¤Ð°Ð·Ñ‹ 2.2, 3, 4...

---

## Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ

ÐŸÐ»Ð°Ð½ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° **Ð¿Ñ€Ð¸Ð½ÑÑ‚ Ñ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð¿Ñ€Ð°Ð²ÐºÐ°Ð¼Ð¸**:

âœ… Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸
âœ… SQLite Ð¾Ð±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½ Ð¸ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½
âœ… ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼ÐµÐ½Ð½Ñ‹Ðµ Ð°Ð´Ð°Ð¿Ñ‚ÐµÑ€Ñ‹ Ð¿Ñ€Ð¸Ð·Ð½Ð°Ð½Ñ‹ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ð¼Ð¸
âœ… Encounter API ÑƒÐ¿Ñ€Ð¾Ñ‰Ñ‘Ð½
âœ… Ð¤Ð°Ð·Ñ‹ Ð¿ÐµÑ€ÐµÑÑ‚Ð°Ð²Ð»ÐµÐ½Ñ‹ (Ñ‚ÐµÑÑ‚Ñ‹ Ð¿ÐµÑ€Ð²Ñ‹Ð¼Ð¸)
âœ… Ð£Ð´Ð°Ð»Ñ‘Ð½ overengineering (CLI, REST, ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹)

**ÐÐ°Ñ‡Ð¸Ð½Ð°Ñ‚ÑŒ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»Ðµ:**
1. Ð¡Ð¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð¸Ñ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹
2. ÐÐ°Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ smoke-Ñ‚ÐµÑÑ‚Ð¾Ð²
3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð»Ð¾Ð³Ð³ÐµÑ€Ð°

**Ð‘ÐµÐ· ÑÑ‚Ð¸Ñ… ÑˆÐ°Ð³Ð¾Ð² Ñ€Ð¸ÑÐº Ñ€ÐµÐ³Ñ€ÐµÑÑÐ¸Ð¸ >90%.**
